<script lang="ts">
  import { propsToDataAttrs } from "@/registry/sveltekit/lib/utilities";
  import "@/registry/sveltekit/components/grid/grid.css";
  import PlaceholderBlock from "@/registry/sveltekit/components/placeholder-block";
	import type { HTMLAttributes } from "svelte/elements";
	import type { Snippet } from "svelte";

// The LiftkitGrid type definition
// 
interface LkGridProps extends HTMLAttributes<HTMLDivElement> {
  columns?: number;
  gap?: LkSizeUnit;
  autoResponsive?: boolean; // Mark as optional since we provide a default
  className?: string; // Optional. Specifying manually here because internal logic checks for it.
}

/**
 * A responsive grid component that provides flexible layout options.
 * NOTE: It's deliberately low-detail. If you need complex features, like areas, asymmetrical column widths, or manual row sizing,
 * we strongly recommend defining your own CSS grid styles and using the `className` prop to apply them.
 *
 * @param columns - The number of columns for the grid layout
 * @param gap - The spacing between grid items. Expects LkSizeUnit from 3xs to 4xl.
 * @param autoResponsive - Whether the grid should automatically adjust to different screen sizes. Defaults to false
 * @param children - The child elements to be rendered within the grid
 * @param restProps - Additional props that will be passed to the underlying div element
 *
 * @returns A div element with grid layout styling and data attributes
 */

  let {
    columns = 2,
    gap = "md",
    autoResponsive = false, // Default value
    children,
    className = "",
    ...restProps
  }: LkGridProps = $props() 
  const columnCount = {};
  const lkGridAttrs = $derived(propsToDataAttrs({ autoResponsive, gap, ...restProps }, "grid"));

  // NextJS version
  // Implemented as Svelte's Templative Syntax

  /**Render placeholder blocks for columns if no children are passed */
  // let placeholderBlocks: Snippet[] = [];

  // if (!children) {
  //   for (let i = 0; i < columns; i++) {
  //     placeholderBlocks.push(<PlaceholderBlock key={i * 2} />);
  //     if (!className) {
  //       placeholderBlocks.push(<PlaceholderBlock key={i * 2 + 1} />);
  //     }
  //   }
  //   children = placeholderBlocks;
  // }

  function getColumnCount() {
    if (!className) return `repeat(${columns}, 1fr)`;
  }
</script>


<div
  data-lk-component="grid"
  {...lkGridAttrs}
  {...restProps}
  class={className}
  style:gridTemplateColumns={getColumnCount()}
> {#if children}
    {@render children() }
    <!-- Render placeholder blocks for columns if no children are passed -->
    {:else}
    {#each Array.from({length: columns}) as column, i}
      {#if !className}
        <PlaceholderBlock data-key={i * 2 + 1} />
      {:else}
        <PlaceholderBlock data-key={i * 2} />
      {/if}
    {/each}
  {/if}
  
</div>
